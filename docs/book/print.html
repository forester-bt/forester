<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Documentation for Forester</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Intro</a></li><li class="chapter-item expanded "><a href="components.html"><strong aria-hidden="true">2.</strong> Components</a></li><li class="chapter-item expanded "><a href="intro_lang.html"><strong aria-hidden="true">3.</strong> Tree language</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="syntax.html"><strong aria-hidden="true">3.1.</strong> Syntax</a></li><li class="chapter-item expanded "><a href="imports.html"><strong aria-hidden="true">3.2.</strong> Imports</a></li><li class="chapter-item expanded "><a href="definitions.html"><strong aria-hidden="true">3.3.</strong> Definitions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="flow.html"><strong aria-hidden="true">3.3.1.</strong> Flow</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="hot.html"><strong aria-hidden="true">3.3.1.1.</strong> Higher order tree</a></li></ol></li><li class="chapter-item expanded "><a href="lambda.html"><strong aria-hidden="true">3.3.2.</strong> Lambda</a></li><li class="chapter-item expanded "><a href="decorators.html"><strong aria-hidden="true">3.3.3.</strong> Decorators</a></li><li class="chapter-item expanded "><a href="actions.html"><strong aria-hidden="true">3.3.4.</strong> Actions</a></li></ol></li><li class="chapter-item expanded "><a href="params.html"><strong aria-hidden="true">3.4.</strong> Parameters</a></li><li class="chapter-item expanded "><a href="args.html"><strong aria-hidden="true">3.5.</strong> Arguments</a></li><li class="chapter-item expanded "><a href="antlr.html"><strong aria-hidden="true">3.6.</strong> Antlr grammar</a></li></ol></li><li class="chapter-item expanded "><a href="engine_intro.html"><strong aria-hidden="true">4.</strong> Runtime engine</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="engine.html"><strong aria-hidden="true">4.1.</strong> Engine</a></li><li class="chapter-item expanded "><a href="bb.html"><strong aria-hidden="true">4.2.</strong> Blackboard</a></li><li class="chapter-item expanded "><a href="r_actions.html"><strong aria-hidden="true">4.3.</strong> Actions</a></li></ol></li><li class="chapter-item expanded "><a href="analysis.html"><strong aria-hidden="true">5.</strong> Analysis</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="validations.html"><strong aria-hidden="true">5.1.</strong> Validations</a></li><li class="chapter-item expanded "><a href="optimizations.html"><strong aria-hidden="true">5.2.</strong> Optimizations</a></li><li class="chapter-item expanded "><a href="viz.html"><strong aria-hidden="true">5.3.</strong> Visualization</a></li><li class="chapter-item expanded "><a href="trace.html"><strong aria-hidden="true">5.4.</strong> Tracing</a></li><li class="chapter-item expanded "><a href="sim.html"><strong aria-hidden="true">5.5.</strong> Simulation</a></li></ol></li><li class="chapter-item expanded "><a href="api.html"><strong aria-hidden="true">6.</strong> How to run</a></li><li class="chapter-item expanded "><a href="f_examples.html"><strong aria-hidden="true">7.</strong> Examples</a></li><li class="chapter-item expanded "><a href="tools.html"><strong aria-hidden="true">8.</strong> Tools</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Documentation for Forester</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <p><img src="pics%2Flogo.png" alt="logo.png" /></p>
<h1 id="forester"><a class="header" href="#forester">Forester</a></h1>
<p>Forester represents a framework that provides the set of tools to perform the effective orchestration of the set of tasks.<br />
The tasks can be performed synchronously or asynchronously, locally or remotely.<br />
Forester takes care of the correct performance and distribution of the tasks.<br />
the main concept of the framework
is the flow based on the <a href="https://en.wikipedia.org/wiki/Behavior_tree_(artificial_intelligence,_robotics_and_control)#:~:text=A%20behavior%20tree%20is%20a,tasks%20in%20a%20modular%20fashion.">behavior trees</a><br />
it can be effectively used in the game, ai, robotic areas, or anywhere where the workflow engine can be applied.</p>
<h2 id="why-forester"><a class="header" href="#why-forester">Why Forester</a></h2>
<p>The main idea and the target of Forester is to make the process of chaining a complex logic<br />
of the different tasks together effective and easy.</p>
<p>The following set of features is summoned to highlight the framework among the others. </p>
<h4 id="the-dsl-to-describe-the-logic"><a class="header" href="#the-dsl-to-describe-the-logic">The dsl to describe the logic</a></h4>
<p>One of the problems that Forester endeavours to solve is to isolate the logic of the orchestration \ 
from the logic of the tasks implementations and therefore the dsl ('Tree') is provided.<br />
The Dsl is script based and supports a number of features that can alleviate the writing of the big trees.</p>
<h4 id="the-framework-provides-the-ability-to-create-async-and-sync-tasks-tbd"><a class="header" href="#the-framework-provides-the-ability-to-create-async-and-sync-tasks-tbd">The framework provides the ability to create async and sync tasks (TBD)</a></h4>
<p>The tasks (leaves of the tree) can be fulfilled with the asynchronous and synchronous logic.
The difference here is the async tasks will not block the tree while sync tasks will block the tree.</p>
<h4 id="the-framework-provides-the-ability-to-create-remote-and-local-tasks-tbd"><a class="header" href="#the-framework-provides-the-ability-to-create-remote-and-local-tasks-tbd">The framework provides the ability to create remote and local tasks (TBD)</a></h4>
<p>The tasks can represent as a local stateless/stateful blocks of logic as the remote servers or procedures.</p>
<h4 id="the-tooling-to-visualize-and-trace-the-execution-of-the-tree-tbd"><a class="header" href="#the-tooling-to-visualize-and-trace-the-execution-of-the-tree-tbd">The tooling to visualize and trace the execution of the tree (TBD)</a></h4>
<p>The tree can be visualized and traced in order to see how it is supposed to be executed.</p>
<h4 id="the-simulation-mode-is-supposed-to-aid-with-the-design-decisions-tbd"><a class="header" href="#the-simulation-mode-is-supposed-to-aid-with-the-design-decisions-tbd">The simulation mode is supposed to aid with the design decisions (TBD)</a></h4>
<p>The special simulation mode aims to help, quickly to see how the tree will be unfolding and how it can be designed.</p>
<h4 id="the-optimizations-and-analysis-of-the-tree-tbd"><a class="header" href="#the-optimizations-and-analysis-of-the-tree-tbd">The optimizations and analysis of the tree (TBD)</a></h4>
<p>The language provides a set of optimizations and validations to either ensure the logic is correct<br />
or perform some validations on it.</p>
<h4 id="the-validations-engine-allows-the-users-to-create-the-manually-defined-validations-tbd"><a class="header" href="#the-validations-engine-allows-the-users-to-create-the-manually-defined-validations-tbd">The validations engine allows the users to create the manually defined validations (TBD)</a></h4>
<p>The user-defined validations can be useful to restrict some features of the framework.</p>
<h4 id="integrations-tbd"><a class="header" href="#integrations-tbd">Integrations (TBD)</a></h4>
<h2 id="why-behaviour-trees"><a class="header" href="#why-behaviour-trees">Why Behaviour trees</a></h2>
<p>Firstly, they provide a strong math abstraction over the orchestration logic<br />
and enables to separate the business logic and the tree logic itself.</p>
<p>On the other hand, they have only a small set of logically conjucted components making the design easier,</p>
<h3 id="articles-that-introduce-into-the-basics-of-the-behaviour-trees"><a class="header" href="#articles-that-introduce-into-the-basics-of-the-behaviour-trees">Articles that introduce into the basics of the behaviour trees</a></h3>
<ul>
<li><a href="https://outforafight.wordpress.com/2014/07/15/behaviour-behavior-trees-for-ai-dudes-part-1/">Chris Simpsonâ€™s Behavior trees for AI: How they work</a></li>
<li><a href="https://robohub.org/introduction-to-behavior-trees/">Introduction to behavior trees</a></li>
<li><a href="https://www.polymathrobotics.com/blog/state-machines-vs-behavior-trees">State Machines vs Behavior Trees</a></li>
</ul>
<h3 id="useful-libraries"><a class="header" href="#useful-libraries">Useful libraries</a></h3>
<ul>
<li><a href="https://www.behaviortree.dev/">BehaviorTree.CPP</a> : the brilliant library provides the implementation on CPP.</li>
<li><a href="https://github.com/bitbrain/beehave">Beehave</a> :  behavior tree AI for Godot Engine.</li>
<li><a href="https://github.com/Sollimann/bonsai">Bonsai</a> : the great library for behaviour trees in rust. </li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="components"><a class="header" href="#components">Components</a></h1>
<p>All in all, the framework provides the following components :</p>
<pre class="mermaid">flowchart LR   
    subgraph Analysis
        direction LR
        Visualization 
        Tracing
        Simulation
    end
    subgraph Scripts
        direction LR
        Tree_lang &lt;--&gt; Validations 
        Validations &lt;--&gt; Optimizations
        Tooling
    end
    
    subgraph Runtime
        direction BT
        Engine &lt;--&gt; Blackboard
        Blackboard &lt;--&gt; ActionKeeper
    end
    

Scripts --&gt; Analysis
Runtime --&gt; Analysis
Scripts --&gt; Runtime

</pre>
<h2 id="scripts"><a class="header" href="#scripts">Scripts</a></h2>
<p>That section describes the language and a way how the users can describe the logic of the trees:</p>
<h3 id="tree-lang"><a class="header" href="#tree-lang">Tree lang</a></h3>
<p>The scripts. They are usually can be stored as a folder with one or more <code>root</code> node which will be executed afterwords.
The syntax of the language takes a vast part of the book and described in the following <a href="./intro_lang.html">chapter</a></p>
<h3 id="validations-and-optimizations"><a class="header" href="#validations-and-optimizations">Validations and Optimizations</a></h3>
<p>These parts come with static analyzer and are conducted when the users compile the scripts into the runtime tree.
They are described in the corresponding sections <a href="./validations.html">Validations</a> and <a href="./optimizations.html">Optimizations</a></p>
<h3 id="tools"><a class="header" href="#tools">Tools</a></h3>
<p>There are some number of extensions for ides to alleviate the writing scripts and running the trees. 
The detailed description is in the chapter <a href="./tools.html">Tools</a></p>
<h2 id="runtime"><a class="header" href="#runtime">Runtime</a></h2>
<p>That is the central part of the framework. The runtime orchestrates the tree execution alongside<br />
with the storing and manipulating some data and actions.</p>
<h3 id="engine"><a class="header" href="#engine">Engine</a></h3>
<p>The main orchestrator. It is described in the chapter <a href="./engine.html">Engine</a></p>
<h3 id="blackboard"><a class="header" href="#blackboard">Blackboard</a></h3>
<p>The component which is responsible for the storing the intermediate data that can be passing across the tree.
The mechanism of working is described in that <a href="./bb.html">chapter</a></p>
<h3 id="actionkeeper"><a class="header" href="#actionkeeper">ActionKeeper</a></h3>
<p>The component stores and processes the user implemented actions (<em>tasks</em> or <em>conditions</em>).
The chapter <a href="./actions.html">Action</a> describes how to interact with ActionKeeper.</p>
<h2 id="analysis"><a class="header" href="#analysis">Analysis</a></h2>
<p>This component helps to analyse the trees and also interacts with them in an easy way</p>
<h3 id="visualization"><a class="header" href="#visualization">Visualization</a></h3>
<p>The users can visualize the tree using graphviz format.
This <a href="./viz.html">section</a> explains how to do that.</p>
<h3 id="tracing"><a class="header" href="#tracing">Tracing</a></h3>
<p>The users can turn on some extra logging that can float up some extra meta information \ 
helpful to design and debug the trees. This <a href="./trace.html">page</a> explains how to handle the tracing.</p>
<h3 id="simulation"><a class="header" href="#simulation">Simulation</a></h3>
<p>The users can run the tree with some stubs instead of the real implementations of the actions. \ 
It can help swiftly define and correct the behavior of the tree itself.
This <a href="./sim.html">chapter</a> describes it.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tree-language"><a class="header" href="#tree-language">Tree language</a></h1>
<p>The tree language is a frontend for the framework itself.
Generally, the language is a simple dsl encompassing the basic abstractions<br />
and enabling to create of the building block upon the abstractions </p>
<h3 id="why-the-language-is-needed"><a class="header" href="#why-the-language-is-needed">Why the language is needed</a></h3>
<p>The basic idea behind the language is an attempt to provide a set of generalizations<br />
which will alleviate the redundancy in some cases.</p>
<ul>
<li>The language allows creating the tree definitions accepting other trees as parameters (higher order trees)</li>
<li>The language provides lambda definitions</li>
</ul>
<p>The syntax of the language is very simple and is described in this chapter.</p>
<h3 id="structure-of-the-project"><a class="header" href="#structure-of-the-project">Structure of the project</a></h3>
<p>The scripts are supposed to be in the folder which is marked as <code>root</code> directory.
All imports start from the root and represent a path relating to the root directory:</p>
<pre><code class="language-file"> - project_folder
    - main.tree
    - gripper.tree
    - cv.tree
    - utility
        - utility.tree
        - helpers.tree
</code></pre>
<p>The project should have at least one <code>root</code> tree <a href="./definitions.html">definition</a>. If the project has several,
the one that is supposed to run needs to be pointed out to.</p>
<h3 id="file-extension"><a class="header" href="#file-extension">File extension</a></h3>
<p>The files have the extension <code>tree</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="syntax"><a class="header" href="#syntax">Syntax</a></h1>
<p>The syntax of the <code>tree</code> language is similar to any average scripting language namely it consists of:</p>
<ul>
<li>tree definitions: subtree that defines a prat of the complete tree.</li>
<li>tree invocations: the calls of the tree definitions.</li>
<li>imports: the instructions that enable import from the other files.</li>
<li>parameters and arguments: that allow passing the values and the other tree to the tree definitions.</li>
<li>lambda: the ability to define the anonymous tree definitions and invoke it at the same time.</li>
<li>comments: the extra information.</li>
</ul>
<p>Below, a simple example that shows the aforementioned points</p>
<pre><code class="language-f-tree">import &quot;nested/impls.tree&quot;
import &quot;nested/impls.tree&quot; {
    grasp =&gt; grasp_ball,
}

root place_ball_to_target fallback {
    place_to(
        obj = {&quot;x&quot;:1 },
        operation = place([10]),
    )
    retry(5) ask_for_help()
}

sequence place_to(what:object, operation:tree){
    fallback {
        is_approachable(what)
        do_job(approach(what))
    }
    fallback {
         is_graspable(what)
         do_job(approach(what))
    }
    sequence {
         savepoint()
         operation(..)
    }
}

sequence place(where:array){
    is_valid_place(where)
    do_job(slowly_drop({&quot;cord&quot;:1}))
}

sequence do_job(action:tree){
    savepoint()
    info_wrapper(action(..))
    savepoint()
}

sequence info_wrapper(action:tree){
    log(&quot;before action&quot;)
    action(..)
    log(&quot;before action&quot;)
}

impl log(text:string);

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="imports"><a class="header" href="#imports">Imports</a></h1>
<p>The code of the trees can be organized as a project, breaking down the tree <a href="./definitions.html">definitions</a> into different files.
It enables the project to be organized logically avoiding redundancy. </p>
<p>Therefore, the imports can appear in the file anywhere but are mostly grouped at the top, forming a sort of header.</p>
<h2 id="syntax-1"><a class="header" href="#syntax-1">Syntax</a></h2>
<h3 id="the-whole-file"><a class="header" href="#the-whole-file">The whole file</a></h3>
<p>To import the whole file, the following syntax needs to be applied:</p>
<pre><code class="language-f-tree">import &quot;nested/impls.tree&quot;
import &quot;/usr/home/projects/impls.tree&quot;
import &quot;C:\projects\forester\tree\tests\plain_project\nested\impls.tree&quot;
</code></pre>
<h3 id="the-definition-with-alias"><a class="header" href="#the-definition-with-alias">The definition with alias</a></h3>
<pre><code class="language-f-tree">import &quot;nested/impls.tree&quot; {
    grasp =&gt; grasp_ball,
}
</code></pre>
<h2 id="import-path"><a class="header" href="#import-path">Import path</a></h2>
<p>The path of the imports can be:</p>
<ul>
<li>absolute : <code>C:\plain_project\nested\impls.tree</code></li>
<li>relative : <code>nested/impls.tree</code></li>
</ul>
<h3 id="absolute-path"><a class="header" href="#absolute-path">Absolute path</a></h3>
<pre><code class="language-f-tree">import &quot;C:\projects\forester\tree\tests\plain_project\nested\impls.tree&quot;
</code></pre>
<h3 id="relative-path"><a class="header" href="#relative-path">Relative path</a></h3>
<p>The relative path relates to the root of the project, that is pointed out in the start.
Typically, the structure is the following:</p>
<pre><code class="language-file">- project_folder
   - main.tree // the file that has a root tree
   - .. folders
   - folder
       - def.tree
   - folder_nested
       - another_nested
           - file.tree    
</code></pre>
<p>Here the import of the <code>file.tree</code> can be</p>
<pre><code>import &quot;folder_nested/another_nested/file.tree&quot;
</code></pre>
<p>in any other file.</p>
<h2 id="aliases"><a class="header" href="#aliases">Aliases</a></h2>
<p>To avoid the problem of ambiguous names when several tree definitions with the same name can be imported,
the aliases can come to the rescue.</p>
<p>They allow renaming tree definition while imports:</p>
<pre><code class="language-f-tree">import &quot;/robot_specific_ops/cv.tree&quot; // has a tree def cv
import &quot;/common_ops/cv.tree&quot; { // also has a tree def cv 
    cv =&gt; com_cv // to avoid ambiguity, we can rename it using an alias.
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tree-definition"><a class="header" href="#tree-definition">Tree definition</a></h1>
<p>The tree definition denotes a part of the tree (so-called subtree) that defines an independent description and can </p>
<ul>
<li>have the input parametersand accept arguments including other trees definitions</li>
<li>invoke other tree definitions and get invoked by others (except <code>root</code>)</li>
</ul>
<p>There are the following types of the definitions:</p>
<ul>
<li>Flow:
the <a href="https://en.wikipedia.org/wiki/Behavior_tree_(artificial_intelligence,_robotics_and_control)#Control_flow_node">core part</a> of the behavior tree framework.
The nodes define a logic of processing the tree itself, navigating for the next step.</li>
<li>Lambda: The anonymous definition of subtree with instant invocation at this place.</li>
<li>Decorator: the atomic built-in tree definition that has one child and can enrich or transform the child result according to its type.</li>
<li>Actions: the leaves of the tree bearing the business logic.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="antlr-grammar"><a class="header" href="#antlr-grammar">Antlr grammar</a></h1>
<p>The grammar bears an introducing character (means it is not used straight in the code for now)</p>
<h2 id="parser"><a class="header" href="#parser">Parser</a></h2>
<pre><code class="language-antlrv4">parser grammar TreeParser;

file
    : (definition | importSt)* EOF
    ;

import_name
    : id (EQ_A id)?
    ;

importCalls
    : LBC (import_name (COMMA import_name)* COMMA?)? RBC
    ;

importSt
    : IMPORT string importCalls?
    ;

definition
    : tree_type id params? (calls? | SEMI)
    ;

call
    : invocation
    | lambda
    ;

invocation
    : id (args | LPR DOT_DOT RPR)
    ;


lambda
    : tree_type args? calls
    ;

calls
    : LBC call* RBC
    | call
    ;


arg
    : id (EQ (message | id | call))?
    | message
    | call
    ;

args
    : LPR (arg (COMMA arg)* COMMA?)? RPR
    ;

params
    : LPR (param (COMMA param)*)? COMMA? RPR
    ;

param
    : id COLON mes_type
    ;

message
    : string
    | num
    | bool
    | array
    | object
    ;

mes_type
    : NUM_T
    | ARRAY_T
    | OBJECT_T
    | STRING_T
    | BOOL_T
    | TREE_T
    ;

tree_type
    : ROOT
    | PARALLEL
    | SEQUENCE
    | MSEQUENCE
    | RSEQUENCE
    | FALLBACK
    | RFALLBACK
    | id          // ambigulty
    ;


object
    : LBC (objectPair (COMMA objectPair)* COMMA? )? RBC
    ;

objectPair
    : string COLON message
    ;


array
    : LBR (message (COMMA message)* COMMA? )? RBR
    ;

bool
    : TRUE
    | FALSE
    ;

num
    : NUMBER
    ;

string
    : STRING
    ;
id
    : ID
    ;
</code></pre>
<h2 id="lexer"><a class="header" href="#lexer">Lexer</a></h2>
<pre><code class="language-antlrv4">lexer grammar TreeLexer;

ROOT: 'ROOT';
PARALLEL : 'parallel';

SEQUENCE : 'sequence';
MSEQUENCE : 'm_sequence';
RSEQUENCE : 'r_sequence';

FALLBACK: 'fallback';
RFALLBACK : 'r_fallback';

ARRAY_T: 'array';
NUM_T: 'num';
OBJECT_T: 'object';
STRING_T: 'string';
BOOL_T: 'bool';
TREE_T: 'tree';
IMPORT: 'import';

ID : [-_a-zA-Z]+ (INT | [-_a-zA-Z]+)*  ;

COMMA : ',';
COLON : ':';
SEMI : ';';
DOT_DOT : '..';

EQ  : '=';
EQ_A  : '=&gt;';

LPR  : '(';
RPR  : ')';

LBC  : '{';
RBC  : '}';

LBR  : '[';
RBR  : ']';

TRUE : 'TRUE';

FALSE : 'FALSE';

STRING  : '&quot;' (ESC | SAFECODEPOINT)* '&quot;' ;

NUMBER  : '-'? INT ('.' [0-9] +)? EXP? ;

Whitespace: [ \t]+ -&gt; skip ;

Newline :   (   '\r' '\n'? | '\n') -&gt; skip ;

BlockComment :   '/*' .*? '*/' -&gt; skip ;

LineComment :   '//' ~[\r\n]* -&gt; skip ;

fragment ESC : '\\' ([&quot;\\/bfnrt] | UNICODE) ;

fragment UNICODE : 'u' HEX HEX HEX HEX ;
fragment HEX : [0-9a-fA-F] ;

fragment SAFECODEPOINT : ~ [&quot;\\\u0000-\u001F] ;
fragment INT : '0' | [1-9] [0-9]* ;
fragment EXP : [Ee] [+\-]? [0-9]+ ;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="optimizations"><a class="header" href="#optimizations">Optimizations</a></h1>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid-init.js"></script>
        <script src="mermaid.min.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
